function jpcrm_mailpoet_initiate_sync(){jQuery("#jpcrm_failed_ajax").hide(),jQuery("#jpcrm_firing_ajax").addClass("active"),jpcrm_mailpoet_fire_sync(function(t){jQuery("#jpcrm_failed_ajax").hide();var e=1e3,a=-1,r=-1;if(void 0!==t.status){switch(t.total_crm_contacts_from_mailpoet&&(document.getElementById("jpcrm-mailpoet-stat-contacts-synced").innerHTML=t.total_crm_contacts_from_mailpoet,0<t.total_crm_contacts_from_mailpoet&&jQuery("#jpcrm-mailpoet-recap-link-to-contacts").removeClass("hidden")),t.status){case"job_in_progress":void 0===window.jpcrm_mailpoet_sync_blocked_runs&&(window.jpcrm_mailpoet_sync_blocked_runs=0),window.jpcrm_mailpoet_sync_blocked_runs++,e=1e4;break;case"sync_part_complete":document.getElementById("jpcrm-mailpoet-status-short-text").textContent=t.status_short_text+" ("+Math.round(t.percentage_completed)+"%)";break;case"sync_completed":return jQuery("#jpcrm_firing_ajax").removeClass("active"),document.getElementById("jpcrm-mailpoet-status-icon").className="icon thumbs up green",document.getElementById("jpcrm-mailpoet-status-short-text").textContent=t.status_short_text,void(document.getElementById("jpcrm-mailpoet-status-long-text").textContent=t.status_long_text);case"not_in_ready_mode":case"error":return jQuery("#jpcrm_firing_ajax").removeClass("active"),jQuery("#jpcrm_failed_ajax").show(),document.getElementById("jpcrm-mailpoet-status-icon").className="icon settings orange",document.getElementById("jpcrm-mailpoet-status-short-text").textContent=t.status_short_text,document.getElementById("jpcrm-mailpoet-status-short-text").className="status orange",void(document.getElementById("jpcrm-mailpoet-status-long-text").textContent=t.status_long_text)}void 0!==t.remaining_pages&&(a=parseInt(t.remaining_pages)),void 0!==t.percentage_completed&&(r=t.percentage_completed);var n="";0<a&&(n=jpcrm_mailpoet_language_label("pages_remain","{0} pages remain").format(a)),0<r&&(n+=" ("+Math.round(r)+"%)"),""!==n&&jQuery("#jpcrm_firing_ajax").attr("title",n),void 0===window.jpcrm_mailpoet_sync_blocked_runs||window.jpcrm_mailpoet_sync_blocked_runs<10?jpcrm_sleep(e).then(()=>{jpcrm_mailpoet_initiate_sync()}):(error_type="caught_mid_job",error_string=jpcrm_mailpoet_language_label(error_type,"Import job is running in the back end. If this message is still shown after some time, please contact support."),jQuery("#jpcrm_firing_ajax").removeClass("active"),document.getElementById("jpcrm-mailpoet-status-short-text").textContent=error_type,document.getElementById("jpcrm-mailpoet-status-long-text").textContent=error_string)}},function(t){var e="";if("timeout"==t.statusText)e=jpcrm_mailpoet_language_label(error_type="caught_mid_job","Import job is running in the back end. If this message is still shown after some time, please contact support.");else{if(0==t.status&&"error"==t.statusText)return;e=jpcrm_mailpoet_language_label(error_type="server_error","There was a general server error.")+" ("+t.status+")",document.getElementById("jpcrm-mailpoet-status-icon").className="icon thumbs down red",document.getElementById("jpcrm-mailpoet-status-short-text").className="status red",sleep_time=2e4,jpcrm_sleep(sleep_time).then(()=>{jpcrm_mailpoet_initiate_sync()})}jQuery("#jpcrm_firing_ajax").removeClass("active"),document.getElementById("jpcrm-mailpoet-status-short-text").textContent=error_type,document.getElementById("jpcrm-mailpoet-status-long-text").textContent=e})}function jpcrm_mailpoet_fire_sync(e,a){var t;window.jpcrm_mailpoet_firing_sync||(window.jpcrm_mailpoet_firing_sync=!0,t={action:"jpcrm_mailpoet_fire_sync_job",sec:window.jpcrm_mailpoet_nonce},jQuery.ajax({type:"POST",url:ajaxurl,data:t,dataType:"json",timeout:2e4,success:function(t){window.jpcrm_mailpoet_firing_sync=!1,"function"==typeof e&&e(t)},error:function(t){window.jpcrm_mailpoet_firing_sync=!1,"function"==typeof a&&a(t)}}))}function jpcrm_mailpoet_language_label(t,e){return void 0!==window.jpcrm_mailpoet_language_labels&&void 0!==window.jpcrm_mailpoet_language_labels[t]?window.jpcrm_mailpoet_language_labels[t]:void 0===e?"":e}jQuery(function(t){var e;window.jpcrm_mailpoet_initiate_ajax_sync&&(jpcrm_mailpoet_initiate_sync(),(e=new URL(location)).searchParams.delete("definitely_restart_sync"),history.replaceState(null,null,e)),jQuery(".jpcrm-clickable").on("click",function(){var t=jQuery(this).attr("data-href");t&&window.open(t,"_blank").trigger("focus")})}),String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(t,e){return void 0!==a[e]?a[e]:t})});