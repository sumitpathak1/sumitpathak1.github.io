function jpcrm_segment_export_to_mailpoet(t){var e;window.zbsSegment.id?(e=jQuery("#zbs-segment-edit-var-title").val(),t.addClass("loading"),jpcrm_mailpoet_retrieve_list_summary(e,function(e){t.removeClass("loading"),e&&e.id?swal.fire({title:zeroBSCRMJS_segmentLang("mailpoet_list_exists"),html:"<p>"+zeroBSCRMJS_segmentLang("mailpoet_list_exists_detail")+"</p>",showCancelButton:!0,confirmButtonText:zeroBSCRMJS_segmentLang("continue_export"),cancelButtonText:zeroBSCRMJS_segmentLang("cancel")}).then(e=>{e.value&&jpcrm_mailpoet_initiate_export(t)}):jpcrm_mailpoet_initiate_export(t)},function(){t.removeClass("loading")})):swal(zeroBSCRMJS_segmentLang("generalerrortitle"),zeroBSCRMJS_segmentLang("nosegmentid"),"error")}function jpcrm_mailpoet_initiate_export(o){var i,e,t;window.zbsAJAXSending||(window.zbsAJAXSending=!0,i=[],jQuery(".zbs-segment-edit-condition").each(function(e,t){var o=jQuery(".zbs-segment-edit-var-condition-type",jQuery(t)).val(),r=jQuery(".zbs-segment-edit-var-condition-operator",jQuery(t)).val(),o={type:o,operator:r=void 0!==r&&"undefined"!=r?r:-1,value:jQuery(".zbs-segment-edit-var-condition-value",jQuery(t)).val(),value2:jQuery(".zbs-segment-edit-var-condition-value-2",jQuery(t)).val()};i.push(o)}),t=jQuery("#zbs-segment-edit-var-title").val(),e=jQuery("#zbs-segment-edit-var-matchtype").val(),t={id:window.zbsSegment.id,title:t,matchtype:e,conditions:i},o.addClass("loading"),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"jpcrm_mailpoet_export_kick_off",segment_id:t.id,sec:window.zbsSegmentSEC},timeout:3e4,success:function(e){return o.removeClass("loading"),1==e.success&&e.mailpoet_list_ID?(swal.fire({title:e.lang.export_in_progress,html:`<div id="jpcrm_segment_mailpoet_modal" style="clear:both" data-complete-title="${e.lang.export_finished}">
                            <p class="jpcrm-export-success">${e.lang.export_in_progress_long}</p>
                            <p class="jpcrm-export-progress"></p>
                            <p style="display:none" class="jpcrm-export-complete">${e.lang.export_finished_long}</p>
                            <a style="display:none" class="jpcrm-export-goto-mailpoet ui button small basic" href="/wp-admin/admin.php?page=mailpoet-subscribers#/filter[segment=${e.mailpoet_list_ID}]">${e.lang.go_to_mailpoet_list}</a>
                            </div>`,showConfirmButton:!1,showCancelButton:!0,allowOutsideClick:!1}),window.jpcrm_mailpoet_cancel_exporting=!1,jQuery(".swal2-cancel").off("click").on("click",()=>{window.jpcrm_mailpoet_cancel_exporting=!0}),jpcrm_segment_batch_export({mailpoet_id:e.mailpoet_list_ID,segment_id:e.jpcrm_segment_ID,page:0,total:e.total_contacts})):swal.fire({title:e.lang.error_title,html:'<div style="clear:both"></div>',showConfirmButton:!1}),window.zbsAJAXSending=!1,"function"==typeof callback&&callback(e),!0},error:function(e,t){swal(zeroBSCRMJS_segmentLang("generalerrortitle"),zeroBSCRMJS_segmentLang("nosegmentid"),"error"),o.removeClass("loading"),window.zbsAJAXSending=!1,console.log("error",e)}}))}function jpcrm_segment_batch_export(e){const{mailpoet_id:o,segment_id:r,page:t,total:i}=e;var e=100,a=Math.ceil(i/e);window.jpcrm_mailpoet_export_fail_count||(window.jpcrm_mailpoet_export_fail_count=0);let n=i;i>e&&(n=t<a?e*(t||1):i),jQuery(".jpcrm-export-progress").html(`
        <div class="jpcrm-export-progress-counter"><span>${n}</span> / ${i}</div>
        <div class="jpcrm-export-progress-bar" style="width:${Math.floor(100*n/i)}%"></div>
    `),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"jpcrm_mailpoet_export_segment",mailpoet_id:o,segment_id:r,page:t,per_page:e},timeout:3e4,success:function(e){var t;!0!==window.jpcrm_mailpoet_cancel_exporting&&(e.is_last_batch?(jQuery(".jpcrm-export-progress").hide(),jQuery(".swal2-cancel").hide(),jQuery(".jpcrm-export-success").hide(),t=jQuery("#jpcrm_segment_mailpoet_modal").attr("data-complete-title"),jQuery(".swal2-title").text(t),jQuery(".jpcrm-export-complete").show(),jQuery(".jpcrm-export-goto-mailpoet").show()):jpcrm_segment_batch_export({mailpoet_id:o,segment_id:r,page:e.current_page+1,total:i}))},error:function(e){if(window.jpcrm_mailpoet_export_fail_count++,!(window.jpcrm_mailpoet_export_fail_count<10))return console.log("Export to MailPoet Error",e),swal(zeroBSCRMJS_segmentLang("generalerrortitle"),zeroBSCRMJS_segmentLang("nosegmentid"),"error"),window.zbsAJAXSending=!1;jpcrm_segment_batch_export({mailpoet_id:o,segment_id:r,page:t,total:i})}})}function jpcrm_mailpoet_retrieve_list_summary(e,t,o){jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"jpcrm_mailpoet_retrieve_list_summary",list_name:e,add_suffix:1},timeout:3e4,success:function(e){return"function"==typeof t&&t(e),e},error:function(e){return console.log("MailPoet summary retrieve error",e),swal(zeroBSCRMJS_segmentLang("generalerrortitle"),zeroBSCRMJS_segmentLang("generalerror"),"error"),"function"==typeof o&&o(),!1}})}